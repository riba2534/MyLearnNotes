# 比特币学习笔记

## 背景

其实之前对比特币区块链的认知只停留在网上的只言片语的介绍中，看的也都是带有科普性质带有各种比喻的小视频，完全无法从本质上了解一下什么是区块链，什么是比特币，矿工又是什么，这对社会有什么实际意义和价值。

自从工作后就比较忙，没时间写博客，周末时间也总想休息。那为什么有了这一篇写比特币区块链的博客，因为最近比特币的价格又一飞冲天（2021年3月13日，比特币突破60000美元），有一句话说得好：「你永远赚不到超出认知范围外的钱」，既然想在币圈赚点钱，就不能被各种概念忽悠了，就需要认知一下什么是比特币。没错，我想搞钱。

## 历史

2008年10月31日，一位化名「中本聪」（Satoshi Nakamoto）的人在网上发表了一篇论文，题目为：「比特币：一种点对点的电子现金系统」（Bitcoin: A Peer-to-Peer Electronic Cash System）

感兴趣的网友可以看一下论文原文：[bitcoin.pdf](https://bitcoin.org/bitcoin.pdf)，巴比特也提供了一个中文翻译版本，讲的也挺好：[比特币白皮书：一种点对点的电子现金系统](https://www.8btc.com/wiki/bitcoin-a-peer-to-peer-electronic-cash-system)

> 维基百科介绍：
>
> **比特币**（英语：Bitcoin[[注 4\]](https://zh.wikipedia.org/wiki/比特币#cite_note-9)，缩写：BTC 或 XBT）是一种基于去中心化，采用[点对点](https://zh.wikipedia.org/wiki/點對點)网络与[共识主动性](https://zh.wikipedia.org/wiki/共识主动性)，[开放源代码](https://zh.wikipedia.org/wiki/開放原始碼)，以[区块链](https://zh.wikipedia.org/wiki/区块链)作为底层技术的[加密货币](https://zh.wikipedia.org/wiki/加密貨幣)[[6\]](https://zh.wikipedia.org/wiki/比特币#cite_note-10)，比特币由[中本聪](https://zh.wikipedia.org/wiki/中本聪)（网名）[[注 5\]](https://zh.wikipedia.org/wiki/比特币#cite_note-11)（Satoshi Nakamoto）于2008年10月31日发表论文[[7\]](https://zh.wikipedia.org/wiki/比特币#cite_note-12)，2009年1月3日，创世区块诞生。在某些国家、[央行](https://zh.wikipedia.org/wiki/央行)、政府机关则将比特币视为[虚拟商品](https://zh.wikipedia.org/wiki/虛擬商品)，而不认为是货币[[8\]](https://zh.wikipedia.org/wiki/比特币#cite_note-13)。
>
> 任何人皆可参与比特币活动，可以通过称为[挖矿](https://zh.wikipedia.org/wiki/挖礦_(比特幣))的电脑运算来发行。比特币协议数量上限为2100万个，以避免[通货膨胀](https://zh.wikipedia.org/wiki/通貨膨脹)问题。使用比特币是透过私钥作为[数字签名](https://zh.wikipedia.org/wiki/数字签名)，允许个人直接支付给他人，与现金相同，不需经过如[银行](https://zh.wikipedia.org/wiki/銀行)、[清算中心](https://zh.wikipedia.org/w/index.php?title=清算中心&action=edit&redlink=1)、[证券商](https://zh.wikipedia.org/wiki/证券商)、[电子支付](https://zh.wikipedia.org/wiki/电子支付)平台等第三方机构，从而避免了高手续费、繁琐流程以及受监管性的问题，任何用户只要拥有可连线互联网的数字设备皆可使用。

## 密码学原理

在了解比特币原理之前，需要稍微了解一些前置的密码学知识。

### 1. 哈希函数（Hash function）：

关于具体的学术性描述，可以看一下维基百科：[散列函数](https://zh.wikipedia.org/wiki/%E6%95%A3%E5%88%97%E5%87%BD%E6%95%B8) 。我这里用大白话来解释一下，假设你有一段内容，把这段内容通过哈希算法来进行计算，计算后会得到一个值，这个值叫做哈希值。**这个过程是不可逆的，你可以通过源文件来得到哈希值，但是不能从哈希值中得到源文件**（假设，你知道 1+2=3 ，但是只给你一个 3 ，你无法得知3 是经过怎样的计算得到的，这个过程中信息是有损失的）。这有什么作用呢，主要作用是用来防止篡改（只要原文经过任何修改，那么得出的哈希值一定不一样）。

一个例子是假设你去网站上下载一部电影，你用下载工具下载好之后，怎么确定你下载的电影是完整的呢，中途有没有数据丢失或者被中间人篡改过。一般的电影网站会公布文件的 MD5，你下载好文件后，用工具计算一下你下载的文件的 MD5 ，和网站上公布的 MD5 进行比较，如果完全一样，则代表你下载的电影是完整的。此处的 MD5 就是一种哈希算法，输入是一个电影文件，输出是一个长度为32的字符串。

在比特币系统中，用的是 SHA-256 哈希算法，这种算法几乎不可能被破解（除非量子计算机面世？）。就是不论什么内容，得出来的是一个256位的字符串，不论原文发生什么修改，字符串都会改变。

> 目前没有人为制造 SHA-256 哈希碰撞的方法，关于哈希碰撞可以看阮一峰的 [哈希碰撞与生日攻击](https://www.ruanyifeng.com/blog/2018/09/hash-collision-and-birthday-attack.html)

### 2. 数字签名：

这里主要讲非对称加密，入门可以看阮一峰的 [数字签名是什么？](https://www.ruanyifeng.com/blog/2011/08/what_is_a_digital_signature.html)

先说一下什么是**对称加密**，假设 A 需要给 B 发送一份文件，这个文件很重要，不希望被第三者窃听，那么 A 就和 B 协商一个算法，给文件进行加密和解密，解密的时候需要用秘钥来进行解密。那 A 先把这个文件加密， B 收到以后用秘钥解密，如果被第三个人窃听了，拿到了一份加密的文件也无济于事。

那什么是**非对称加密**呢，非对称加密，就是一个加密算法，会生成两个秘钥，一个叫做「公钥」，一个叫做「私钥」。那这个东西怎么用呢，还是刚才的例子，A 要给 B 发文件，文件很机密，为了防止第三个人窃听。B 首先生成自己的公钥和私钥，把公钥公布到网络中（谁都知道，包括窃听者），A收到B给他发的公钥之后，用 B 的公钥把这一份重要的文件加密，发送给 B , B收到文件之后，用自己的私钥来解密，这样，就算窃听者拿到了文件，但是没有B的私钥，同样也解不开。

表面上看，这对称和非对称没啥区别啊，都可以防止第三者窃听。但是你需要思考一个问题，假设A和B只能通过网络进行通信，没有其他通信方式，所有的交流都会被第三者窃听，那么如果用对称加密的话，A和B商量的密码肯定会被第三者知道，但是用非对称加密，私钥一直是保管在自己手里的，所以不可能被其他人知道。

最常用的非对称加密算法是 RSA 算法，感兴趣可以自己学习，非对称加密应用也很广泛，比较常见的有，SSH 协议的认证，HTTPS协议中。

那么，「数字签名」是啥，有啥用？举个例子，我是某个国家的国王，我要颁布法律，法律的内容不能随意更改，那么别人看到这个法律文件的时候，怎么确保法律就一定是国王颁布的呢，万一有人偷偷改了怎么办。这个时候，国王可以先把法律写完，然后用哈希函数，先生成一个哈希值，也叫「摘要」。然后用自己的私钥，把这个哈希值加密，得到的东西叫做「数字签名」。那这玩意有啥用呢，作用在于，由于国王的公钥是公开的，民众得到法律文件以后，可以用国王的公钥验证这个签名是不是对的，用公钥可以从数字签名中解密出哈希值，然后群众把法律文件算一下哈希值和数字签名中的哈希值进行对比，就知道法律文件有没有被篡改过了。

为什么？如果其他人篡改了，由于他没有国王的私钥，所以无法生成可信的数字签名，群众拿国王的公钥验证的时候会不通过。

总结一下：

- 对称加密
  - 加密双方使用同一密钥进行加密解密
- 非对称加密
  - 分为公钥和私钥
  - 公钥和私钥成对出现
  - 用公钥加密的数据只有对应私钥可以解密
  - 用私钥加密的数据只有对应公钥可以解密
  - 公钥一般用于加密和验证签名
  - 私钥一般用于解密和进行数字签名

在比特币系统中，主要是对交易进行签名，比如A要给B转10个BTC，A需要把这个交易发布到区块链上，那么别人怎么知道这个交易是A发起的呢，所以A把交易发布到区块链上的时候，用自己的私钥签名，别人如果要验证这个交易是不是A发起的，只需要用A的公钥对这个交易验证即可。

## BTC数据结构





